[{"categories":["pytorch"],"content":"torch.nn.DataParallel ","date":"151512-1215-08","objectID":"/hugosite/dataparallel-the-dimension-of-output-is-different-from-input/:0:0","tags":["pytorch","CV"],"title":"DataParallel  the Dimension of Output Is Different From Input","uri":"/hugosite/dataparallel-the-dimension-of-output-is-different-from-input/"},{"categories":["pytorch"],"content":"é—®é¢˜æè¿° å½“ä½¿ç”¨nn.DataParallelåŒ…è£¹æ¨¡å‹åï¼Œæ¨¡å‹è¾“å…¥çš„Batchç»´åº¦å’Œè¾“å‡ºçš„batchç»´åº¦ä¸ä¸€è‡´ï¼Œæ­¤é—®é¢˜å°¤å…¶ä¼šå‡ºç°åœ¨å¤šä¸ªè¾“å…¥çš„æƒ…å†µä¸‹ï¼Œä¸”å…¶ä¸­æŸä¸ªè¾“å…¥ä¸ºäº†èŠ‚çœèµ„æºè¢«å…±ç”¨çš„æƒ…å†µä¸‹ã€‚ ä¸¾ä¾‹è¯´æ˜æƒ…å†µï¼š å‡è®¾modelæ­£å¸¸æ¥å—ä¸¤ä¸ªè¾“å…¥$x_1 \\in [N, C, H, W]$, $x_2\\in [1, M, N]$, ä¸”æ¨¡å‹è¾“å‡ºä¸º$y_1 \\in [N, C, H2, W2]$ã€‚ è‹¥modelè¢«nn.DataParallelåŒ…è£¹åä¸”ä½¿ç”¨2ä¸ªGPUæ—¶ï¼Œå‡è®¾$x_1, x_2$ä¸å˜ï¼Œæ­¤æ—¶è¾“å‡ºå°†å˜ä¸º$y_{new}\\in [N/2, C, H, W]$ã€‚ # ä»£ç æ¼”ç¤º from torch import nn import torch class Model(nn.Module): def __init__(self): super(Model, self).__init__() pass def forward(self, x1, x2): # implementation details return x1, x2 if __name__ == '__main__': import os os.environ['CUDA_VISIBLE_DEVICES'] = '1,2' x1 = torch.randn((10, 3, 128, 128)) x2 = torch.randn((1, 100, 200)) model = Model() dp = nn.DataParallel(model) y1, y2 = dp(x1, x2) y3, y4 = model(x1, x2) print(torch.__version__) print('y1: {}, y2:{}'.format(y1.shape, y2.shape)) print('y3: {}, y4:{}'.format(y3.shape, y4.shape)) output of code: torch version: 1.5.0+cu101 y1: torch.Size([5, 3, 128, 128]), y2:torch.Size([1, 100, 200]) y3: torch.Size([10, 3, 128, 128]), y4:torch.Size([1, 100, 200]) ","date":"151512-1215-08","objectID":"/hugosite/dataparallel-the-dimension-of-output-is-different-from-input/:1:0","tags":["pytorch","CV"],"title":"DataParallel  the Dimension of Output Is Different From Input","uri":"/hugosite/dataparallel-the-dimension-of-output-is-different-from-input/"},{"categories":["pytorch"],"content":"åŸå› åˆ†æ ä¸»è¦åŸå› åœ¨äºè¾“å…¥ä¸­çš„æŸä¸€ä¸ªTensorè¢«å¤ç”¨ï¼Œä½†å…¶batchä¸º1å¯¼è‡´çš„ã€‚ å½“modelè¢«nn.DataParallelåŒ…è£¹åï¼ˆå‡è®¾å…¶ä¸ºdp)ï¼Œåœ¨æ‰§è¡Œ y1, y2 = dp(x1, x2) æ—¶ï¼Œdpæ¨¡å‹çš„$forward$å‡½æ•°ä¼šå…ˆè¢«è°ƒç”¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…¶forwardå‡½æ•°æ˜¯æ€ä¹ˆæ„æˆçš„: def forward(self, *inputs, **kwargs): with torch.autograd.profiler.record_function(\"DataParallel.forward\"): if not self.device_ids: return self.module(*inputs, **kwargs) for t in chain(self.module.parameters(), self.module.buffers()): if t.device != self.src_device_obj: raise RuntimeError(\"module must have its parameters and buffers \" \"on device {}(device_ids[0]) but found one of \" \"them on device: {}\".format(self.src_device_obj, t.device)) # æ­¤å¤„ä¼šå¯¹è¾“å…¥åœ¨dim=0ä¸Šè¿›è¡Œæ‹†åˆ†ï¼Œ # æœ‰å‡ å—å¡å°±æ‹†åˆ†ä¸ºå‡ ä»½ï¼Œå› ä¸ºæˆ‘ä»¬çš„x2çš„ç¬¬ä¸€ä¸ªç»´åº¦ï¼ˆdim=0ï¼‰ä¸ºä¸€ #æ— æ³•å†è¿›è¡Œæ‹†åˆ†ï¼Œå¯¼è‡´äº†æ­¤é—®é¢˜ï¼Œå¯è¿›ä¸€æ­¥æ¢å¯»self.catterå…·ä½“æ˜¯å¦‚ä½•å·¥ä½œçš„ inputs, kwargs = self.scatter(inputs, kwargs, self.device_ids) # ... å…¶ä»–codeä¸ºèŠ‚çœç©ºé—´ï¼Œçœç•¥ ä¸Šè¿°ä»£ç ä¸­ï¼Œ$self.scatter$å‡½æ•°ä¼šå¯¹æ‰€æœ‰è¾“å…¥æ•°æ®æŒ‰æ¯”ä¾‹è¿›è¡Œæ‹†åˆ†ï¼Œæœ‰å¤šå°‘å—å¡æ¯ä¸ªè¾“å…¥å°±ä¼šåœ¨dim=0ä¸Šè¢«æ‹†åˆ†ä¸ºå¤šå°‘ä»½ã€‚è€Œä¾‹å­ä¸­$x2$ç¬¬ä¸€ç»´ä¸º1ï¼Œæ— æ³•è¿›ä¸€æ­¥æ‹†åˆ†ï¼Œæ‰€ä»¥è™½ç„¶$x1$çš„æ‹†åˆ†æœ‰ä¸¤ä¸ªï¼Œæœ€ç»ˆèƒ½å¤ŸåŒ¹é…çš„ä»½æ•°è¿˜æ˜¯ä¸€ã€‚ä¸ªäººæ„Ÿè§‰ä¸ä¸‹åˆ—ä»£ç åŠŸèƒ½ç±»ä¼¼ï¼š x1 = [1, 2] x2 = [1] for i, j in zip(x1, x2): # åªä¼šå¾ªç¯ä¸€æ¬¡ print(i, j) ","date":"151512-1215-08","objectID":"/hugosite/dataparallel-the-dimension-of-output-is-different-from-input/:2:0","tags":["pytorch","CV"],"title":"DataParallel  the Dimension of Output Is Different From Input","uri":"/hugosite/dataparallel-the-dimension-of-output-is-different-from-input/"},{"categories":["pytorch"],"content":"è§£å†³æ–¹æ¡ˆ å°†å…±ç”¨çš„Tensorçš„0ç»´åº¦ç¿»å€ï¼Œå»ºè®®ä½¿ç”¨expandæ”¹å˜Tensorçš„view(viewæ˜¯Tensorçš„è§†å›¾ï¼Œå¯çœ‹æˆTensorçš„ç»´åº¦)ã€‚expandä¸ä¼šå¯¹Tensorè¿›è¡Œå¤åˆ¶ï¼Œç›¸æ¯”äºrepeatèƒ½å¤ŸèŠ‚çœå†…å­˜ã€‚ x1 = torch.randn((10, 3, 128, 128)) x2 = torch.randn((1, 100, 200)) # å¯¹x2çš„viewè¿›è¡Œè°ƒæ•´ï¼Œå°†å…¶è°ƒæ•´ä¸ºGPU_numçš„å€æ•°ï¼Œä»¥2ä¸ºä¾‹ x2 = x2.expand(2, -1, -1) model = Model() dp = nn.DataParallel(model) y1, y2 = dp(x1, x2) y3, y4 = model(x1, x2) print(torch.__version__) print('y1: {}, y2:{}'.format(y1.shape, y2.shape)) print('y3: {}, y4:{}'.format(y3.shape, y4.shape)) outputs: torch version: 1.5.0+cu101 y1: torch.Size([10, 3, 128, 128]), y2:torch.Size([2, 100, 200]) y3: torch.Size([10, 3, 128, 128]), y4:torch.Size([2, 100, 200]) ","date":"151512-1215-08","objectID":"/hugosite/dataparallel-the-dimension-of-output-is-different-from-input/:3:0","tags":["pytorch","CV"],"title":"DataParallel  the Dimension of Output Is Different From Input","uri":"/hugosite/dataparallel-the-dimension-of-output-is-different-from-input/"},{"categories":["pytorch"],"content":"é¢å¤–æ¢ç´¢å®éªŒ å°†x2çš„batchç»´åº¦æ”¹ä¸º3 x1 = torch.randn((10, 3, 128, 128)).cuda() x2 = torch.randn((3, 100, 200)).cuda() model = Model() dp = nn.DataParallel(model) y1, y2 = dp(x1, x2) y3, y4 = model(x1, x2) print('torch version:', torch.__version__) print('y1: {}, y2:{}'.format(y1.shape, y2.shape)) print('y3: {}, y4:{}'.format(y3.shape, y4.shape)) outputs: torch version: 1.5.0+cu101 y1: torch.Size([10, 3, 128, 128]), y2:torch.Size([3, 100, 200]) y3: torch.Size([10, 3, 128, 128]), y4:torch.Size([3, 100, 200]) æ³¨æ„ æ­¤æ—¶$x1$,$x2$çš„åˆ’åˆ†ä¸º GPU0: x1 shape is [5, 3, 128, 128], x2 shape is [2, 100, 100] GPU1: x2 shape is [5, 3, 128, 128], x2 shape is [1, 100, 100] ","date":"151512-1215-08","objectID":"/hugosite/dataparallel-the-dimension-of-output-is-different-from-input/:4:0","tags":["pytorch","CV"],"title":"DataParallel  the Dimension of Output Is Different From Input","uri":"/hugosite/dataparallel-the-dimension-of-output-is-different-from-input/"},{"categories":["image processing"],"content":"å›¾åƒæ’å€¼ ğŸ˜„ æœ¬æ–‡å‚è€ƒæ­¤åšå®¢ pytorch interpolation torch.nn.functional.interpolate å¯èƒ½å°†æ­£åƒç´ æ’å€¼ä¸ºè´Ÿåƒç´ ï¼ˆå¾…æŸ¥æ˜ï¼‰ ","date":"90912-129-08","objectID":"/hugosite/bilinear_interpolation/:0:0","tags":["image processing","CV"],"title":"Bilinear_interpolation åŸç†åŠå®ç°","uri":"/hugosite/bilinear_interpolation/"},{"categories":["python"],"content":"The first post ğŸ˜„ hhhhhh ","date":"80812-128-08","objectID":"/hugosite/python%E4%B8%AD-__init__.py-%E7%9A%84%E4%BD%BF%E7%94%A8/:0:0","tags":["python","module"],"title":"__init__.py æ¢ç´¢","uri":"/hugosite/python%E4%B8%AD-__init__.py-%E7%9A%84%E4%BD%BF%E7%94%A8/"},{"categories":null,"content":"The first post ","date":"1011-11-08","objectID":"/hugosite/pytorch-ddp%E6%8E%A2%E7%B4%A2/:0:0","tags":null,"title":"pytorch DDP æ¢ç´¢","uri":"/hugosite/pytorch-ddp%E6%8E%A2%E7%B4%A2/"}]